Title: Gas Station Traffic Simulation with SUMO and SimPy
Date: 2024-08-04 10:20
Modified: 2024-08-04 10:20
Category: traffic simulation
Tags: sumo, simpy, traffic, simulation
Status: draft
Slug: gas-station-traffic-simulation-with-SimPy-SUMO
Authors: Sean Reed
lang: eng
Summary: A demo of gas station traffic simulation using SUMO and SimPy

In this blog post, I will show how how simulations of complex dynamic processes within traffic models or, on the flipside, traffic flows can be modelled realistically within discrete event simulations by combining two simulation tools - SimPy and SUMO. To do this, I'm going to use an example of a simple scenario of a roadside gas station where passing car traffic refuels and, when the station fuel storage tank becomes low, a tanker truck is called to replenish it. But first, let me give a brief introduction to SUMO and SimPy:

[SUMO](https://sumo.dlr.de/) is a microscopic simulation package for modelling traffic in networks of up to city scale. The simulation engine is space continuous and advances time in small discrete steps of equal duration (usually 1 second or less of simulated time) with the actions of each vehicle, such as acceleration rates and lane change decisions, updated based on its intended route and the vehicles ahead of it (known as a [car following model](https://sumo.dlr.de/docs/Car-Following-Models.html). A [Python module called TraCI](https://sumo.dlr.de/docs/TraCI/Interfacing_TraCI_from_Python.html) is bundled with SUMO and provides the ability to control, interact with, and observe a running simulation through a Python API. SimPy, on the other hand, is a discrete event simulation Python library for modelling systems or processes that evolve through a sequence of events that occur at discrete points in time, with the simulation clock advancing by jumping to the time of the next event at each step. Both SimPy and SUMO are great tools in their own right and, to top it all, they are free, open-source, and work on all platforms (Windows, Mac, and Linux).

Whilst SUMO has excellent features for modelling traffic (including vehicles, road networks, and traffic infrastructure like traffic lights), you might want to build a model that incorporates additional dynamic processes that the traffic interacts with in some way. For example, the operations of a taxi firm that receives booking requests, assigns drivers working shift patterns, and dispatches vehicles from its fleet to pick-up and drop-off passengers. Trying to write code to model complex scenarios like that and ensure all the simulated processes, entities and resources are correctly coordinated can quickly grow into a tangled web that is difficult to understand and inefficient when simulated. These are the types of scenario that a discrete event simulation library, such as SimPy, excels at modelling by providing a set of functions for representing the processes and resources involved, and the interactions between them, along with a simulation engine for synchronizing the execution of events in an efficient way. For this reason, I think there is great potential for the use of hybrid continuous/discrete simulations that combine SUMO and SimPy within integrated models. 

In this demo, a simulation model that integrates SimPy and SUMO has been implemented to model a gas station with 3 pumps where cars arrive to refuel and a refueling truck is called to replenish the station's fuel tank when its level falls too low. It has been adapted from an example of this scenario that is included in the SimPy documentation you can find [here](https://simpy.readthedocs.io/en/latest/examples/gas_station_refuel.html). In that original example, the vehicles (cars and refuelling truck) are not modelled explicitly, but instead "teleport" to the station. There is also no graphical representation, only text output to the console describing the events that occur (e.g. a car arrives to refuel). In this modified version, SUMO has been incorporated to model vehicles explicitly as they interact with one another in the road network. Through the SUMO graphical user interface (GUI) tool, the simulation is also visualized in 2D. I've tried to keep as close to the concept of the original example from the SimPy docs as possible, only replacing the very abstract simulation of vehicles from the original with the much more realistic simulation made possible by using SUMO.

<img src="static/images/blog-posts/gas-station-sumo/sumogui-gas-station.png" class="img-fluid rounded mx-auto d-block" title="Screenshot of the gas station model in SUMO-GUI tool" alt="Screenshot of the gas station model in SUMO-GUI tool" />

Although this example is quite simple, I hope it demonstrates the possibilities for combining SimPy (or other DES libraries) with SUMO. When you need to model very complex scenarios in a SUMO traffic simulation, for example container yard and port operations, road maintenance crews or even sophisticated traffic management systems, integrating SimPy like this can be a powerful approach. It significantly simplifies the modelling implementation by providing a neat interface for representing the logic within and between multiple interacting processes and shared resources and an efficient simulation engine for managing the scheduling of events. Likewise, when building simulations in SimPy that need to include the modelling traffic in a large or intricate transportation network, with realistic interactions between vehicles, incorporating SUMO provides a nice way to do that. SUMO also includes some very powerful data analysis and visualization capabilities, for example to see where traffic jams develop in the network or for estimating vehicle emissions.

I hope you found this demo interesting or useful and who knows, maybe you're even inspired to integrate SimPy and SUMO in your existing or future simulation projects. Please let me know if you would be interesting in seeing more demos or tutorials on SimPy, SUMO or other simulation topics!